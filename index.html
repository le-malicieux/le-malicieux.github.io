<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Le Malicieux - Catalogue d'Animes</title>

<style>
:root{--primary:#ff4757;--bg:#0f0f0f;--card-bg:rgba(20,20,20,.9);--text:#eee;--nav-bg:rgba(15,15,15,.85)}

body{
font-family:'Segoe UI',sans-serif;
background:var(--bg) url('img/fond1.jpg') center/cover fixed;
color:var(--text);
margin:0;min-height:100vh
}

/* NAVBAR PC */
.top-navbar{
display:flex;align-items:center;justify-content:space-between;
padding:10px 20px;background:var(--nav-bg);
position:sticky;top:0;z-index:1000;
border-bottom:1px solid rgba(255,255,255,.1)
}

.nav-left{display:flex;align-items:center;gap:12px}
.nav-logo-small{width:35px;height:35px;border-radius:5px;border:1px solid var(--primary)}
.nav-title{color:var(--primary);font-weight:700}

.nav-center{display:flex;gap:8px;align-items:center}
.nav-center input,.nav-center select,.nav-center button,.nav-center a{
background:#222;border:1px solid #444;color:#fff;padding:6px 10px;border-radius:4px;font-size:.85em;text-decoration:none}

.btn-red{background:var(--primary)!important;border:none!important;font-weight:700;color:#fff!important}
.discord-btn{background:#7289da;color:#fff;padding:6px 12px;border-radius:5px;font-size:.85em;font-weight:700;text-decoration:none}

/* MOBILE MENU */
.mobile-btn{display:none;font-size:22px;background:none;border:none;color:#fff;cursor:pointer}

.mobile-menu{
position:fixed;top:0;left:-270px;width:260px;height:100%;
background:rgba(15,15,15,.98);
z-index:3000;padding:20px;
display:flex;flex-direction:column;gap:12px;
transition:.25s ease;
pointer-events:none
}

.mobile-menu.active{left:0;pointer-events:auto}

.mobile-overlay{
position:fixed;inset:0;background:rgba(0,0,0,.5);
z-index:2500;opacity:0;pointer-events:none;transition:.2s
}

.mobile-overlay.active{opacity:1;pointer-events:auto}

.mobile-menu input,.mobile-menu select,.mobile-menu button,.mobile-menu a{
width:100%;background:#222;border:1px solid #444;color:#fff;padding:8px;border-radius:5px;text-align:center;text-decoration:none}

/* HERO */
.hero-section{height:55vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px}
.main-logo{width:130px;height:130px;border-radius:20px;border:3px solid var(--primary);margin-bottom:15px}
.main-title{font-size:2.5em;margin:0}
.main-slogan{font-size:1.2em;font-weight:700}

/* CONTENT */
.content-area{background:linear-gradient(to top,rgba(0,0,0,.95)70%,transparent);padding:40px 10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:15px;max-width:1300px;margin:auto}

.card{background:var(--card-bg);border-radius:8px;overflow:hidden;transition:.2s;border:1px solid #333;font-size:.75em;color:inherit;text-decoration:none}
.card:hover{transform:translateY(-6px);border-color:var(--primary)}
.card img{width:100%;height:230px;object-fit:cover}
.card-info{padding:8px}
.card-title{font-weight:700;color:var(--primary);height:2.4em;overflow:hidden}
.tag{background:rgba(255,71,87,.2);color:var(--primary);padding:1px 4px;border-radius:3px}

/* RESPONSIVE */
@media(max-width:900px){
.nav-center,#auth-ui,.top-navbar>.discord-btn{display:none}
.mobile-btn{display:block}
.hero-section{height:45vh}
.main-title{font-size:2em}
}
</style>
</head>
<body>

<!-- MOBILE -->
<div class="mobile-overlay" id="overlay"></div>

<div class="mobile-menu" id="mobile-menu">
<h3 style="color:var(--primary);text-align:center">â˜° Menu</h3>
<input id="m-search" placeholder="Recherche...">
<select id="m-sort">
<option value="">Trier...</option>
<option value="nom">Nom</option>
<option value="popularite">PopularitÃ©</option>
<option value="score">Score</option>
<option value="sortie">AnnÃ©e</option>
</select>
<a href="playlist.html" class="btn-red">ğŸ“‚ Playlist</a>
<button onclick="randomAnime()" class="btn-red">ğŸ² Random</button>
<div id="mobile-auth"></div>
<a href="https://discord.gg/4DY3Zq4vW4" target="_blank" class="discord-btn">Discord</a>
</div>

<!-- NAVBAR -->
<div class="top-navbar">
<div class="nav-left">
<button class="mobile-btn" id="menu-btn">â˜°</button>
<img src="img/logo.jpg" class="nav-logo-small">
<span class="nav-title">Le Malicieux</span>
</div>

<div class="nav-center">
<input id="search" placeholder="Recherche...">
<select id="sort">
<option value="">Trier...</option>
<option value="nom">Nom</option>
<option value="popularite">PopularitÃ©</option>
<option value="score">Score</option>
<option value="sortie">AnnÃ©e</option>
</select>
<a href="playlist.html" class="btn-red">ğŸ“‚ Playlist</a>
<button onclick="randomAnime()" class="btn-red">ğŸ² Random</button>
</div>

<div id="auth-ui"></div>
<a href="https://discord.gg/4DY3Zq4vW4" target="_blank" class="discord-btn">Discord</a>
</div>

<!-- HERO -->
<div class="hero-section">
<img src="img/logo.jpg" class="main-logo">
<h1 class="main-title">le-malicieux.github.io</h1>
<p class="main-slogan">Catalogue d'animes malicieux</p>
</div>

<!-- CONTENT -->
<div class="content-area">
<div id="anime-container" class="grid"></div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import{getAuth,onAuthStateChanged,signInWithPopup,GoogleAuthProvider,signOut}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig={apiKey:"AIzaSyCD70a-QR2nJnHBnA-FUoIGHZ7Z3VByPMk",authDomain:"le-malicieux-v2.firebaseapp.com",projectId:"le-malicieux-v2"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const provider=new GoogleAuthProvider();

let allAnimes=[];

const container=document.getElementById('anime-container');

/* MENU */
const menu=document.getElementById('mobile-menu');
const overlay=document.getElementById('overlay');

document.getElementById('menu-btn').onclick=()=>{
menu.classList.add('active');
overlay.classList.add('active');
};

overlay.onclick=()=>{
menu.classList.remove('active');
overlay.classList.remove('active');
};

/* AUTH */
onAuthStateChanged(auth,user=>{
const authUI=document.getElementById('auth-ui');
const mobileAuth=document.getElementById('mobile-auth');

if(user){
const html=`<span class="auth-status">${user.displayName}</span><button id="logoutBtn" class="discord-btn" style="background:#333">DÃ©connexion</button>`;
authUI.innerHTML=html;
mobileAuth.innerHTML=html;
document.getElementById('logoutBtn').onclick=()=>signOut(auth);
}else{
const html=`<button id="loginBtn" class="discord-btn" style="background:var(--primary)">Connexion</button>`;
authUI.innerHTML=html;
mobileAuth.innerHTML=html;
document.getElementById('loginBtn').onclick=()=>signInWithPopup(auth,provider);
}
});

/* LOAD CSV (LOGIQUE ORIGINALE) */
async function init(){
try{
const response=await fetch('animes.csv');
const raw=await response.text();

allAnimes=raw.split(/\r?\n/).slice(1).map(line=>{
const c=line.split(';');
const clean=s=>s?s.trim().replace(/^"|"$/g,''):"";

if(!c[0]||c.length<9)return null;

return{
nom:clean(c[0]),
pop:clean(c[1]),
score:clean(c[2]),
sortie:clean(c[3]),
ep:clean(c[4]),
censure:clean(c[5]),
etat:clean(c[6]),
img:clean(c[8])
};
}).filter(Boolean);

displayAnimes(allAnimes);

}catch(e){console.error(e)}
}

/* DISPLAY (ORIGINAL) */
function displayAnimes(list){
container.innerHTML="";

list.forEach(a=>{
const base=a.img.includes('.')?a.img.split('.')[0]:a.img;

container.innerHTML+=`
<a href="video.html?name=${encodeURIComponent(a.nom)}" class="card">
<img loading="lazy" src="img/${base}.jpg" onerror="this.src='https://via.placeholder.com/170x230'">
<div class="card-info">
<div class="card-title">${a.nom}</div>
<div>ğŸ“… ${a.sortie} â€¢ ğŸ“º ${a.ep}</div>
<span class="tag">${a.censure}</span> â­ ${a.score}
</div>
</a>`;
});
}

/* SORT */
function applySort(v){
let sorted=[...allAnimes];

if(v==="nom")sorted.sort((a,b)=>a.nom.localeCompare(b.nom));
if(v==="score")sorted.sort((a,b)=>parseFloat(b.score)-parseFloat(a.score));
if(v==="popularite")sorted.sort((a,b)=>(parseInt(a.pop.replace('#',''))||999)-(parseInt(b.pop.replace('#',''))||999));
if(v==="sortie")sorted.sort((a,b)=>b.sortie.localeCompare(a.sortie));

displayAnimes(sorted);
}

sort.onchange=e=>applySort(e.target.value);
m-sort.onchange=e=>{applySort(e.target.value);menu.classList.remove('active');overlay.classList.remove('active');};

/* SEARCH */
function applySearch(v){
v=v.toLowerCase();
displayAnimes(allAnimes.filter(a=>a.nom.toLowerCase().includes(v)));
}

search.oninput=e=>applySearch(e.target.value);
m-search.oninput=e=>applySearch(e.target.value);

/* RANDOM */
window.randomAnime=function(){
if(allAnimes.length){
const a=allAnimes[Math.floor(Math.random()*allAnimes.length)];
location=`video.html?name=${encodeURIComponent(a.nom)}`;
}
};

init();
</script>
</body>
</html>
